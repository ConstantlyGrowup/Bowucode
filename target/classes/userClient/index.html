<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>"é»‘æ‚Ÿç©º"ä¸»é¢˜æ•°å­—æ–‡æ—…å¹³å°</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="HandheldFriendly" content="True">
    <!-- Bootstrap v4.3.1 CSS -->
    <link rel="stylesheet" href="lib/bootstrap/css/bootstrap.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/theme.css">
    <!-- Slick CSS -->
    <link rel="stylesheet" type="text/css" href="lib/slick/slick/slick.css">
    <link rel="stylesheet" type="text/css" href="lib/slick/slick/slick-theme.css">
    <!-- Magnific Popup core CSS file -->
    <link rel="stylesheet" href="lib/Magnific-Popup-master/dist/magnific-popup.css">
    <!-- Font Awesome Free 5.10.2 CSS JS -->
    <link href="lib/fontawesome-free-5.10.2-web/css/all.css" rel="stylesheet">
    <script defer src="lib/fontawesome-free-5.10.2-web/js/brands.js"></script>
    <script defer src="lib/fontawesome-free-5.10.2-web/js/solid.js"></script>
    <script defer src="lib/fontawesome-free-5.10.2-web/js/fontawesome.js"></script>
    <script src="./util/vue.js"></script>
    <script src="./util/axios.js"></script>
    <script src="./util/request.js"></script>
    <script src="lib/echarts/echarts.js"></script>
    <style scoped>
        /* CSSæ ·å¼ */
        .popup {
            position: fixed; /* è®¾ç½®å®šä½ä¸ºfixedï¼Œä½¿å…¶ç›¸å¯¹äºè§†å£è¿›è¡Œå®šä½ */
            top: 50%; /* å°†å‚ç›´å±…ä¸­ */
            left: 50%; /* å°†æ°´å¹³å±…ä¸­ */
            transform: translate(-50%, -50%); /* é€šè¿‡transformå±æ€§ç§»åŠ¨åˆ°æ­£ç¡®çš„ä½ç½® */
            width: 80%; /* è®¾ç½®å®½åº¦ */
            height: 50vh; /* è®¾ç½®é«˜åº¦ */
            overflow-y: auto;
            background-color: #fff; /* è®¾ç½®èƒŒæ™¯è‰² */
            border: 1px solid #ccc; /* è®¾ç½®è¾¹æ¡† */
            padding: 10px; /* è®¾ç½®å†…è¾¹è· */
            z-index: 9999;
        }

        /* å¯¼è§ˆåƒ§æ‚¬æµ®æ ·å¼ - æ›´æ–° */
        .tour-monk-float {
            position: fixed;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 999;
            transition: all 0.3s ease;
        }

        .tour-monk-link {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: #333;
            padding: 8px;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .tour-monk-link:hover {
            transform: scale(1.05);
        }

        .monk-image {
            width: 150px; /* å¢åŠ å›¾ç‰‡å°ºå¯¸ */
            height: auto;
            margin-bottom: 5px;
        }

        .monk-text {
            font-size: 16px; /* å¢åŠ æ–‡å­—å°ºå¯¸ */
            font-weight: bold;
            text-align: center;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8); /* æ·»åŠ æ–‡å­—é˜´å½±ä»¥å¢å¼ºå¯è¯»æ€§ */
        }

        /* åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šè°ƒæ•´å¤§å°å’Œä½ç½® */
        @media (max-width: 768px) {
            .tour-monk-float {
                right: 10px;
                bottom: 70px;
                top: auto;
                transform: none;
            }

            .monk-image {
                width: 70px; /* ç§»åŠ¨è®¾å¤‡ä¸Šçš„å›¾ç‰‡å°ºå¯¸ä¹Ÿå¢åŠ  */
            }

            .monk-text {
                font-size: 14px;
            }
        }
    </style>
</head>
<body class="default">
<div class="preloading">
    <div class="wrap-preload">
        <div class="cssload-loader"></div>
    </div>
</div>
<!-- Header  -->
<div id="loginVue">
    <nav class="navbar navbar-expand-lg navbar-light bg-header">
        <div class="container-fluid">
            <div class="logo">
                "é»‘æ‚Ÿç©º"ä¸»é¢˜æ•°å­—æ–‡æ—…å¹³å°
                <span style="float: right" v-if="userInf.id == null">
                            <a type="button" class="theme-button" href="ChatTest.html" style="font-size: 10px;margin-right: 10px;">Aiå¯¼è§ˆåƒ§</a>
                            <a type="button" class="theme-button" href="login.html" style="font-size: 10px">ç™»å½•</a>
                        </span>
                <span style="float: right;font-size: 10px;" v-if="userInf.id != null">
                            <a type="button" class="theme-button" href="ChatTest.html" style="font-size: 10px;margin-right: 10px;">Aiå¯¼è§ˆåƒ§</a>
                            <a type="button" class="theme-button" href="setting.html" style="font-size: 10px">æ¬¢è¿ï¼š{{userInf.nickname}}</a>
                            <a type="button" class="theme-button" href="javascript:void(0)" @click="loginOut()" style="font-size: 10px">ç™»å‡º</a>
                        </span>
            </div>
        </div>
    </nav>
</div>
<!-- .Header  -->
<!-- Content  -->
<div id="content">
    <!-- Content Wrap  -->
    <div class="content-wrap">
        <!-- slider -->
        <div class="img-hero">
            <div>
                <img src="img/slide-index1.jpg" alt="slider">
            </div>
            <div>
                <img src="img/slide-index2.jpg" alt="slider">
            </div>
        </div>
        <div id="app">
            <div class="home-icon">
                <div class="section-home">
                    <div class="container">
                        <div class="row">
                            <div class="col s-icon" v-for="(item, index) in colTyps" v-if="index<=4" @click="gotoDetial(item.dicValue)">
                                <a href="javascript:void(0)"  class="homepage-icon-menu">
                                    <img :src="'img/m' + (index+1) + '.png'" alt="icon">
                                    <div class="s-icon-text">
                                        {{item.dicValue}}
                                    </div>
                                </a>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col s-icon" v-for="(item, index) in colTyps" v-if="index>4 && index<=8" @click="gotoDetial(item.dicValue)">
                                <a href="javascript:void(0)" class="homepage-icon-menu">
                                    <img :src="'img/m' + (index+1) + '.png'" alt="icon">
                                    <div class="s-icon-text">
                                        {{item.dicValue}}
                                    </div>
                                </a>
                            </div>
                        </div>
                        <!-- æ·»åŠ ç¬¬ä¸‰è¡Œï¼ŒåŒ…å«é…’åº—æ°‘å®¿å’Œæ™¯åŒºå¿…ç©æ¦œ -->
                        <div class="row" style="display: flex; justify-content: center; margin-top: 15px;">
                            <div class="col s-icon" style="margin: 0 15px;">
                                <a href="https://map.baidu.com/search/%E9%85%92%E5%BA%97/@12349827.74,4372592.12,19z?querytype=nb&r=1000&wd=%E9%85%92%E5%BA%97&nb_x=12349827.75&nb_y=4372592.13&uid=0058610845d2cfa646e274df&b=(12349450.354975866,4372430.124158017;12350205.136797978,4372801.618336087)&l=19&gr_radius=1000&pn=0&device_ratio=1&da_src=shareurl"
                                   class="homepage-icon-menu">
                                    <img src="img/m11.png" alt="icon">
                                    <div class="s-icon-text">
                                        é…’åº—æ°‘å®¿
                                    </div>
                                </a>
                            </div>
                            <div class="col s-icon" style="margin: 0 15px;">
                                <a href="https://map.baidu.com/search/%E6%99%AF%E7%82%B9/@12325156.51000001,4337590.690000011,11z?querytype=nb&c=368&wd=%E6%99%AF%E7%82%B9&da_src=shareurl&on_gel=1&l=11&gr=1&b=(12202276.51000001,4277110.690000011;12448036.51000001,4398070.690000011)&pl_data_type=scope&pl_price_section=0,%2B&pl_sort_rule=0&pl_discount2_section=0,%2B&pl_groupon_section=0,%2B&pl_cater_book_pc_section=0,%2B&pl_hotel_book_pc_section=0,%2B&pl_ticket_book_flag_section=0,%2B&pl_movie_book_section=0,%2B&pl_business_type=scope&uid=0058610845d2cfa646e274df&nb_x=12349827.75&nb_y=4372592.13&gr_radius=1000&pn=0&device_ratio=1"
                                   class="homepage-icon-menu">
                                    <img src="img/m10.png" alt="icon">
                                    <div class="s-icon-text">
                                        æ™¯åŒºå¿…ç©æ¦œ
                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="heading-section" style="display: flex">
                <div v-for="item in menuData" :key="item.id" :id="item" @click="checkMenu(item)" :class="{'ischeck': item.id === menuId}" style="padding: 10px;font-size: 15px;cursor: pointer">{{item.name}}</div>
            </div>
            <div class="row" style="max-height: 80vh;overflow-y: auto">
                <div v-if="showReservePop" class="popup">
                    <a href="#" style="float: right" @click="showReservePop = false">å…³é—­</a>
                    <dv>
                        <button @click="showReservePop = false">å…³é—­</button>
                    </dv>
                    <p v-html="popHtml"></p>
                </div>
            </div>
            <div class="row" style="max-height: 80vh;overflow-y: auto">
                <div v-if="showAnnooucementPop" class="popup">
                    <a href="#" style="float: right" @click="showAnnooucementPop = false">å…³é—­</a>
                    <div class="subsite-heading">
                        {{annoObj.title}}
                    </div>
                    <p v-html="annoObj.contentText"></p>
                </div>
            </div>
            <div class="row" style="max-height: 80vh;overflow-y: auto">
                <div v-if="showAnnouncementDetailPop" class="popup">
                    <a href="javascript:void(0)" style="float: right" @click="closeAnnouncementDetail">å…³é—­</a>
                    <div class="subsite-heading">
                        {{currentAnnouncement.title}}
                    </div>
                    <p v-html="currentAnnouncement.contentText"></p>
                    <!-- æ·»åŠ å…¬å‘Šæ—¶é—´ -->
                    <div class="announcement-date">
                        å‘å¸ƒæ—¶é—´ï¼š{{currentAnnouncement.date}}
                    </div>
                </div>
            </div>

            <!-- é¢„çº¦è¯¦æƒ…å¼¹çª— -->
            <div class="row" style="max-height: 80vh;overflow-y: auto">
                <div v-if="showReserveDetailPop" class="popup" style="width: 90%; max-width: 800px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); padding: 20px;">
                    <a href="javascript:void(0)" style="float: right; font-size: 16px;" @click="closeReserveDetail">å…³é—­</a>
                    <div class="subsite-heading" style="text-align: center; margin-bottom: 20px; font-size: 22px; color: #333;">
                        {{currentReserve.title}}
                    </div>
                    <div class="reserve-info">
                        <div style="display: flex; flex-wrap: wrap; margin-bottom: 15px;">
                            <div style="flex: 1; min-width: 250px; margin-bottom: 10px;">
                                <p style="font-size: 16px;"><strong>é¢„çº¦æ—¶é—´:</strong> {{currentReserve.resDate}} {{currentReserve.resTime}}</p>
                                <p style="font-size: 16px;"><strong>å¯é¢„çº¦æ•°:</strong> {{currentReserve.resSum - currentReserve.resdSum}}/{{currentReserve.resSum}}</p>
                            </div>
                            <div style="flex: 1; min-width: 250px; margin-bottom: 10px;">
                                <div id="reserveChart" style="height: 200px; width: 100%;"></div>
                            </div>
                        </div>

                        <p style="font-size: 16px;"><strong>é¢„çº¦è¯¦æƒ…:</strong></p>
                        <p style="font-size: 15px; line-height: 1.5; margin-bottom: 15px;" v-html="currentReserve.resDes"></p>

                        <div v-if="currentReserve.collections && currentReserve.collections.length > 0">
                            <p style="font-size: 16px;"><strong>åŒ…å«è—å“:</strong></p>
                            <div class="collections-list" style="display: flex; flex-wrap: wrap; gap: 15px; margin: 15px 0;">
                                <div v-for="collection in currentReserve.collections" :key="collection.id" class="collection-item"
                                     style="padding: 10px; border-radius: 8px; background-color: #f5f7fa; min-width: 150px; display: flex; align-items: center;">
                                    <img v-if="collection.colPic" :src="'http://localhost:8090/api/file/getPic?name=' + collection.colPic"
                                         style="width: 50px; height: 50px; border-radius: 8px; margin-right: 10px; object-fit: cover;">
                                    <div>{{collection.title}}</div>
                                </div>
                            </div>
                        </div>
                        <div v-else style="font-style: italic; color: #999; margin: 15px 0;">
                            è¯¥é¢„çº¦æš‚æ— å…³è”è—å“
                        </div>

                        <div style="text-align: center; margin-top: 20px;">
                            <button class="theme-button" @click="goToReserve(currentReserve.id)"
                                    :disabled="currentReserve.resSum <= currentReserve.resdSum"
                                    style="padding: 10px 30px; font-size: 16px;">
                                ç«‹å³é¢„çº¦
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å…¬å‘Šåˆ—è¡¨ -->
            <div v-if="menuId === 1" class="section-home home-news">
                <!-- éå†å…¬å‘Šæ•°æ® -->
                <div class="home-news-wrap">
                    <div v-for="(item, index) in announcementData" :key="item.id" class="news-item">
                        <div class="news-content" style="display: flex;">
                            <!-- å…¬å‘Šæ ‡é¢˜å’Œå†…å®¹ -->
                            <div class="hnw-desc" style="width: 100%">
                                <div class="hnw-title" style="font-weight: bold; font-size: 18px; color: #0b0b0b; margin-bottom: 12px;">
                                    {{ item.title }}
                                </div>
                                <!-- å…¬å‘Šå†…å®¹ç®€è¦ -->
                                <div class="hnw-text">
                                    <p style="color: #666; margin-bottom: 12px; font-size: 15px;" v-html="item.contentText ? (item.contentText.length > 30 ? item.contentText.slice(0, 30) + '...' : item.contentText) : 'æš‚æ— å…¬å‘Šå†…å®¹'"></p>
                                    <!-- æŸ¥çœ‹è¯¦æƒ…æŒ‰é’® -->
                                    <span class="more" style="color: #2450a6; cursor: pointer; font-size: 15px;" @click="showAnnouncementDetail(item)">æŸ¥çœ‹è¯¦æƒ…</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- åˆ†é¡µæ§åˆ¶ -->
                <div class="pagination-container" style="text-align: center; margin-top: 20px;">
                    <span class="page-info" style="margin-right: 10px;">ç¬¬ {{queryInfo.pagenum}} é¡µ</span>
                    <button class="theme-button" @click="prevPage" :disabled="queryInfo.pagenum <= 1">ä¸Šä¸€é¡µ</button>
                    <button class="theme-button" @click="nextPage" :disabled="!hasNextPage">ä¸‹ä¸€é¡µ</button>
                </div>
            </div>

            <!-- é¢„çº¦åˆ—è¡¨ -->
            <div v-if="menuId === 2" class="section-home home-news">
                <div class="home-news-wrap">
                    <div v-for="(item, index) in reserveData" :key="item.id" class="news-item">
                        <div class="news-content" style="display: flex;">
                            <div class="hnw-desc" style="width: 100%">
                                <div class="hnw-title" style="font-weight: bold; font-size: 18px; color: #0b0b0b; margin-bottom: 12px;">
                                    {{ item.title }}
                                </div>
                                <div class="hnw-text">
                                    <p style="color: #666; margin-bottom: 12px; font-size: 15px;">
                                        æ—¶é—´: {{ item.resDate }} {{ item.resTime }} | å‰©ä½™: {{ item.resSum - item.resdSum }}/{{ item.resSum }}
                                    </p>
                                    <span class="more" style="color: #2450a6; cursor: pointer; font-size: 15px;" @click="showReserveDetail(item)">æŸ¥çœ‹è¯¦æƒ…</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- åˆ†é¡µæ§åˆ¶ -->
                <div class="pagination-container" style="text-align: center; margin-top: 20px;">
                    <span class="page-info" style="margin-right: 10px;">ç¬¬ {{queryInfo.pagenum}} é¡µ</span>
                    <button class="theme-button" @click="prevPage" :disabled="queryInfo.pagenum <= 1">ä¸Šä¸€é¡µ</button>
                    <button class="theme-button" @click="nextPage" :disabled="!hasNextPage">ä¸‹ä¸€é¡µ</button>
                </div>
            </div>

            <!-- è—å“åˆ—è¡¨ -->
            <div v-if="menuId === 3 || menuId === 4" id="newsItem" class="home-news-wrap">
                <!-- éå†è—å“æ•°æ® -->
                <div>
                    <a :href="'collDetail.html?id='+item.id" v-for="(item, index) in collectionData" v-if="item.origin">
                        <div class="news-item" @mouseenter="handleMouseEnter(item)" @mouseleave="handleMouseLeave(item)">
                            <div class="news-content" style="display: flex;">
                                <div class="hnw-img" style="margin-right: 20px;">
                                    <img style="max-width: 80px;max-height: 80px;border-radius: 10px;" :src="'http://localhost:8090/api/file/getPic?name=' + item.colPic" alt="news">
                                </div>
                                <div class="hnw-desc">
                                    <div style="font-weight: bold; font-size: 18px;">{{ item.title }}</div>
                                    <div class="hnw-text">
                                        <p style="font-size: 15px;" v-html="item.desColl.length > 100 ? item.desColl.slice(0, 100) + '...' : item.desColl"></p>
                                        <span class="more" style="font-size: 15px;">æŸ¥çœ‹è¯¦æƒ…</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </a>
                    <!-- æŸ¥çœ‹æ›´å¤šè—å“ - å±…ä¸­æ˜¾ç¤º -->
                    <div class="more-category" v-if="collectionData && collectionData.length > 0 && collectionData[0].origin" style="text-align: center; margin: 20px 0;">
                        <a href="col-list.html">
                            <div class="theme-button mcbutton">æŸ¥çœ‹æ›´å¤š</div>
                        </a>
                    </div>
                </div>
            </div>

            <!-- å†å²äººæ–‡æ–°é—»åˆ—è¡¨ -->
            <div v-if="menuId === 5" class="section-home home-news">
                <!-- åŠ è½½çŠ¶æ€ -->
                <div v-if="newsLoading" class="loading-container" style="text-align: center; padding: 40px;">
                    <div style="color: #666; font-size: 16px;">æ­£åœ¨åŠ è½½å†å²äººæ–‡æ–°é—»...</div>
                </div>
                
                <!-- æ–°é—»æ•°æ®ä¸ºç©º -->
                <div v-else-if="!newsData || newsData.length === 0" class="empty-container" style="text-align: center; padding: 40px;">
                    <div style="color: #999; font-size: 16px;">æš‚æ— å†å²äººæ–‡æ–°é—»æ•°æ®</div>
                </div>
                
                <!-- æ–°é—»æ‰¹æ¬¡åˆ—è¡¨ -->
                <div v-else class="home-news-wrap">
                    <div v-for="(batch, batchIndex) in newsData" :key="batch.BatchId" class="news-batch">
                        <!-- æ‰¹æ¬¡æ ‡é¢˜ -->
                        <div class="batch-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px 20px; margin-bottom: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                            <div style="font-size: 18px; font-weight: bold; margin-bottom: 5px;">
                                ğŸ“° å†å²äººæ–‡æ–°é—»
                            </div>
                            <div style="font-size: 14px; opacity: 0.9;">
                                æ‰¹æ¬¡æ—¶é—´: {{ formatBatchTime(batch.BatchTime) }}
                            </div>
                        </div>
                        
                        <!-- æ–°é—»æ¡ç›®åˆ—è¡¨ -->
                        <div class="news-items">
                            <div v-for="(item, itemIndex) in batch.Items" :key="item.ItemId" class="news-item" style="margin-bottom: 20px; border: 1px solid #e8e8e8; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                                <div class="news-content" style="padding: 20px; background: white;">
                                    <!-- æ–°é—»æ ‡é¢˜ -->
                                    <div class="hnw-title" style="font-weight: bold; font-size: 18px; color: #2c3e50; margin-bottom: 12px; line-height: 1.4;">
                                        {{ item.Title }}
                                    </div>
                                    
                                    <!-- æ–°é—»å…ƒä¿¡æ¯ -->
                                    <div class="news-meta" style="display: flex; align-items: center; margin-bottom: 12px; font-size: 13px; color: #7f8c8d;">
                                        <span style="margin-right: 15px;">
                                            <i class="fas fa-calendar-alt" style="margin-right: 5px;"></i>
                                            {{ formatNewsDate(item.NewsDate) }}
                                        </span>
                                        <span style="margin-right: 15px;">
                                            <i class="fas fa-newspaper" style="margin-right: 5px;"></i>
                                            {{ item.Media }}
                                        </span>
                                    </div>
                                    
                                    <!-- æ–°é—»å†…å®¹æ‘˜è¦ -->
                                    <div class="hnw-text" style="margin-bottom: 15px;">
                                        <p style="color: #555; font-size: 15px; line-height: 1.6; margin: 0;">
                                            {{ item.Content }}
                                        </p>
                                    </div>
                                    
                                    <!-- æŸ¥çœ‹åŸæ–‡é“¾æ¥ -->
                                    <div class="news-actions">
                                        <a :href="item.Link" target="_blank" style="color: #3498db; text-decoration: none; font-size: 14px; display: inline-flex; align-items: center;">
                                            <i class="fas fa-external-link-alt" style="margin-right: 5px;"></i>
                                            æŸ¥çœ‹åŸæ–‡
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="section-subscribe">
            <div class="subcontainer">
                <div class="subrow">
                    <div class="subcol">
                        <div class="section-title">ç•™è¨€å»ºè®®</div>
                        <div class="mail-subscribe-box">
                            <form name="subsribe">
                                <input v-model="feedContext" class="form-control" name="user-email" placeholder="å¦‚éœ€æ”¹è¿›ï¼Œæ¬¢è¿å°ä¸»åé¦ˆ...." value="" type="email">
                                <button @click="sendFeedBack()" type="button" class="submitsub"> <i class="fa fa-angle-right"></i></button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bg-subscribe">
                <img src="img/image.jpg" alt="banner">
            </div>
        </div>
    </div>
</div>
</div>
<!-- .Content  -->
<!-- åº•éƒ¨é¢æ¿  -->
<div class="bottom-panel">
    <div class="bp-col">
        <a href="index.html">
            <div class="bp-icon"><img src="img/iphome.png" alt="icon"> </div>
            <div class="selected-bottom-text">é¦–é¡µ</div>
        </a>
    </div>
    <div class="bp-col">
        <a href="col-list.html">
            <div class="bp-icon"><img src="img/ipoffer2.png" alt="icon"></div>
            <div class="bp-text">è—å“</div>
        </a>
    </div>
    <div class="bp-col">
        <a href="ReserveDetail.html">
            <div class="bp-icon"><img src="img/ipcar.png" alt="icon"></div>
            <div class="bp-text">æˆ‘çš„é¢„çº¦</div>
        </a>
    </div>
    <div class="bp-col">
        <a href="setting.html">
            <div class="bp-icon"><img src="img/ipaccount.png" alt="icon"></div>
            <div class="bp-text">ä¸ªäººä¸­å¿ƒ</div>
        </a>
    </div>
</div>
<!-- .Bottom Panel  -->
<div class="tour-monk-float">
    <a href="ChatTest.html" class="tour-monk-link" title="ç‚¹å‡»å¼€å§‹AIæ™ºèƒ½å¯¼è§ˆ">
        <img src="img/tourMonk1.png" alt="å¯¼è§ˆåƒ§" class="monk-image">
        <div class="monk-text">å¯¼è§ˆåƒ§</div>
    </a>
</div>
<div class="overlay"></div>
<!-- Optional JavaScript -->
<!-- jQuery v3.4.1 -->
<script src="lib/jquery/jquery-3.4.1.min.js"></script>
<!--  Bootstrap v4.3.1 JS -->
<script src="lib/bootstrap/js/bootstrap.min.js"></script>
<!-- Magnific Popup core JS file -->
<script src="lib/Magnific-Popup-master/dist/jquery.magnific-popup.js"></script>
<!-- Slick JS -->
<script src="lib/slick/slick/slick.min.js"></script>
<!--  Custom JS -->
<script src="js/theme.js"></script>

<script src="lib/elementui/element.js"></script>
<script src="lib/elementui/css/element.css"></script>
<script>
    const vm = new Vue({
        el: '#app',
        data: {
            menuData: [
                { id: 1, name: 'è¿‘æœŸæ–°é—»å…¬å‘Š' },
                { id: 2, name: 'é¢„çº¦ä¸€è§ˆ' },
                { id: 3, name: 'è—å“ä¸€è§ˆ' },
                { id: 4, name: 'çƒ­é—¨è—å“' },
                { id: 5, name: 'å†å²äººæ–‡' }
            ],
            userInf: {}, // ç”¨æˆ·ä¿¡æ¯ä»æ¥å£è·å–
            showAnnooucementPop: false,
            annoObj: {},
            menuId: 1,
            colTyps : [],
            collectionData : [],
            queryInfo: {
                name: '',
                pagenum: 1,
                pagesize: 5,  // æ¯é¡µæ˜¾ç¤º6æ¡å…¬å‘Š
                menuName: 'è—å“ä¸€è§ˆ'
            },
            feedContext: '',
            isNewsDesc: false,
            collectionDataDesc: {},
            resSum: 0,
            resdSum: 0,
            feedContext: '',
            showReservePop: false,
            popHtml: '',
            announcementData: [], // å­˜å‚¨å…¬å‘Šåˆ—è¡¨æ•°æ®
            announcementList: [],    //å­˜å‚¨ç½®é¡¶å…¬å‘Šæ•°æ®
            total: 0,        // æ€»è®°å½•æ•°
            hasNextPage: true, // æ˜¯å¦æœ‰ä¸‹ä¸€é¡µ
            showAnnouncementDetailPop: false,  // æ§åˆ¶è¯¦æƒ…å¼¹çª—æ˜¾ç¤º
            currentAnnouncement: {},           // å½“å‰æŸ¥çœ‹çš„å…¬å‘Š
            showReserveDetailPop: false,
            currentReserve: {},
            reserveData: [],
            // å†å²äººæ–‡æ–°é—»æ•°æ®
            newsData: [], // å­˜å‚¨æ–°é—»æ‰¹æ¬¡æ•°æ®
            newsLoading: false, // æ–°é—»åŠ è½½çŠ¶æ€
        },
        mounted() {
            this.getData()
            this.getAnnouncementData()
            this.getColData()
            this.fetchUserMe() // è·å–ç”¨æˆ·ä¿¡æ¯
            this.getAnnouncementList()
        },
        methods: {
            fetchUserMe() {
                try {
                    // ä» sessionStorage ä¸­è¯»å– token
                    const token = sessionStorage.getItem('token');
                    console.log('å½“å‰tokenä¸ºï¼š ', token)
                    // å¦‚æœ token ä¸ºç©ºï¼Œè¡¨ç¤ºå½“å‰ä¸ºæ¸¸å®¢æ¨¡å¼ï¼Œä¸è°ƒç”¨ me æ¥å£
                    if (!token) {
                        console.log('æœªæ£€æµ‹åˆ° tokenï¼Œå½“å‰ä¸ºæ¸¸å®¢æ¨¡å¼');
                        this.userInf = {}; // ç¡®ä¿ç”¨æˆ·ä¿¡æ¯ä¸ºç©ºå¯¹è±¡
                        return;
                    }

                    // è°ƒç”¨ /api/user/me æ¥å£è·å–ç”¨æˆ·ä¿¡æ¯
                    get('/user/me').then(response => {
                        // æ£€æŸ¥æ¥å£è¿”å›çš„çŠ¶æ€ç 
                        if (response.code === 200) {
                            if (response.data) {
                                // æœ‰ç”¨æˆ·æ•°æ®ï¼Œè¡¨ç¤ºå·²ç™»å½•
                                this.userInf = response.data;
                                console.log('å·²è·å–ç”¨æˆ·ä¿¡æ¯:', this.userInf);
                            } else {
                                // æ•°æ®ä¸ºç©ºï¼Œè¡¨ç¤º token å¯èƒ½æ— æ•ˆæˆ–è¿‡æœŸ
                                console.log('æœªè·å–åˆ°ç”¨æˆ·ç™»å½•ä¿¡æ¯ï¼Œå½“å‰ä¸ºæ¸¸å®¢æ¨¡å¼');
                                this.userInf = {}; // æ¸…ç©ºç”¨æˆ·ä¿¡æ¯
                            }
                        } else {
                            // è¯·æ±‚æˆåŠŸä½†è¿”å›äº†é”™è¯¯ç 
                            console.error('è¯·æ±‚å¤±è´¥:', response.msg);
                            this.userInf = {}; // æ¸…ç©ºç”¨æˆ·ä¿¡æ¯
                        }
                    }).catch(error => {
                        // ç½‘ç»œé”™è¯¯æˆ–åç«¯å¼‚å¸¸
                        console.error('è·å–ç”¨æˆ·ä¿¡æ¯æ—¶å‘ç”Ÿå¼‚å¸¸:', error);
                        this.userInf = {}; // æ¸…ç©ºç”¨æˆ·ä¿¡æ¯
                    });
                } catch (error) {
                    console.error('fetchUserMeæ–¹æ³•æ‰§è¡Œå‡ºé”™:', error);
                    this.userInf = {}; // ç¡®ä¿ç”¨æˆ·ä¿¡æ¯ä¸ºç©ºå¯¹è±¡
                }
            },
            checkMenu(item) {
                this.menuId = item.id
                this.queryInfo.menuName = item.name

                if (item.id === 1) {
                    // è¿‘æœŸæ–°é—»å…¬å‘Š
                    this.queryInfo.pagenum = 1;
                    this.getAnnouncementData();
                } else if (item.id === 2) {
                    // é¢„çº¦ä¸€è§ˆ
                    this.queryInfo.pagenum = 1;
                    this.getReserveData();
                } else if (item.id === 3 || item.id === 4) {
                    // è—å“ä¸€è§ˆæˆ–çƒ­é—¨è—å“
                    this.queryInfo.pagenum = 1;
                    this.getColData();
                } else if (item.id === 5) {
                    // å†å²äººæ–‡
                    this.getNewsData();
                }
            },
            showPop(item) {
                this.showReservePop = true
                this.popHtml = item.resDes
            },
            getData() {
                post('/dic/listColType', {dicTyp: 'è—å“åˆ†ç±»'}).then(response => {
                    this.colTyps = response.data;
                }).catch(err => {
                    console.log(err);
                });
            },
            async getAnnouncementList() {
                post('/announcement/listMsAnnouncementTop', {}).then(res => {
                    if (res.code !== 200) {
                        alert(res.msg)
                        return
                    }else {
                        this.announcementList = res.data.list
                        if(this.announcementList && this.announcementList.length > 0) {
                            this.showAnnooucementPop = true
                            this.annoObj = this.announcementList[0]
                        }
                    }
                }).catch(err => {
                    console.log(err);
                });
            },
            getColData() {
                post('/collect/getdataTop', this.queryInfo).then(response => {
                    this.collectionData = response.data.list;
                }).catch(err => {
                    console.log(err);
                });
            },
            gotoDetial(category) {
                console.log('ç‚¹å‡»åˆ†ç±»:', category);
                // ä½¿ç”¨encodeURIComponentç¡®ä¿ä¸­æ–‡ç­‰ç‰¹æ®Šå­—ç¬¦è¢«æ­£ç¡®ç¼–ç 
                window.location.href = 'col-list.html?type=' + encodeURIComponent(category);
            },
            sendFeedBack(value) {
                const token = sessionStorage.getItem('token')
                if(token === null || token === '') {
                    window.location.href='login.html'
                    return
                }
                // ä» userInf ä¸­è·å–ç”¨æˆ·ä¿¡æ¯
                if (!this.userInf || !this.userInf.id) {
                    alert('è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥')
                    return
                }
                if(this.feedContext === '') {
                    alert('è¯·è¾“å…¥ç•™è¨€ä¿¡æ¯')
                    return;
                }
                const info = {
                    userId: this.userInf.id,
                    cateId: '',
                    feedContent: this.feedContext,
                    userName: this.userInf.username
                }
                post('/feedBack/addFeedBack', info).then(response => {
                    alert('æˆåŠŸï¼')
                    this.feedContext = ''
                }).catch(err => {
                    console.log(err);
                });
            },
            getAnnouncementData() {
                post('/announcement/listMsAnnouncement', this.queryInfo)
                    .then(response => {
                        if (response.code === 200) {
                            this.announcementData = response.data.list || [];
                            this.total = response.data.total;
                            this.hasNextPage = this.queryInfo.pagenum * this.queryInfo.pagesize < this.total;
                        } else {
                            alert(response.msg);
                        }
                    })
                    .catch(err => {
                        console.log(err);
                    });
            },
            // ä¸Šä¸€é¡µ
            prevPage() {
                if (this.queryInfo.pagenum > 1) {
                    this.queryInfo.pagenum--;
                    if (this.menuId === 1) {
                        this.getAnnouncementData();
                    } else if (this.menuId === 2) {
                        this.getReserveData();
                    } else {
                        this.getColData();
                    }
                }
            },
            // ä¸‹ä¸€é¡µ
            nextPage() {
                if (this.hasNextPage) {
                    this.queryInfo.pagenum++;
                    if (this.menuId === 1) {
                        this.getAnnouncementData();
                    } else if (this.menuId === 2) {
                        this.getReserveData();
                    } else {
                        this.getColData();
                    }
                }
            },
            // æ˜¾ç¤ºå…¬å‘Šè¯¦æƒ…
            showAnnouncementDetail(announcement) {
                this.currentAnnouncement = announcement;
                this.showAnnouncementDetailPop = true;
            },
            // å…³é—­å…¬å‘Šè¯¦æƒ…
            closeAnnouncementDetail(e) {
                e.preventDefault(); // é˜»æ­¢é»˜è®¤è¡Œä¸ºï¼Œå¦åˆ™é¡µé¢ä¼šè‡ªåŠ¨å›åˆ°é¡¶ç«¯
                this.showAnnouncementDetailPop = false;
            },
            getReserveData() {
                post('/reserve/listMsReserveClient', this.queryInfo)
                    .then(response => {
                        if (response.code === 200) {
                            this.reserveData = response.data.list || [];
                            this.total = response.data.total;
                            this.hasNextPage = this.queryInfo.pagenum * this.queryInfo.pagesize < this.total;
                        } else {
                            alert(response.msg);
                        }
                    })
                    .catch(err => {
                        console.log(err);
                    });
            },
            showReserveDetail(reserve) {
                this.currentReserve = reserve;
                this.showReserveDetailPop = true;


                this.$nextTick(() => {

                    const chartDom = document.getElementById('reserveChart');
                    if (!chartDom) return;

                    const myChart = echarts.init(chartDom);

                    const pieData = [
                        { value: reserve.resSum - reserve.resdSum, name: 'å¯é¢„çº¦' },
                        { value: reserve.resdSum, name: 'å·²é¢„çº¦' }
                    ];

                    const option = {
                        tooltip: {
                            trigger: 'item',
                            formatter: '{b}: {c} ({d}%)'
                        },
                        legend: {
                            orient: 'horizontal',
                            bottom: 0,
                            data: ['å¯é¢„çº¦', 'å·²é¢„çº¦']
                        },
                        series: [
                            {
                                type: 'pie',
                                radius: ['40%', '70%'],
                                avoidLabelOverlap: false,
                                label: {
                                    show: true,
                                    position: 'inside',
                                    formatter: '{d}%',
                                    fontSize: 14
                                },
                                emphasis: {
                                    label: {
                                        show: true,
                                        fontSize: 16,
                                        fontWeight: 'bold'
                                    }
                                },
                                labelLine: {
                                    show: false
                                },
                                data: pieData,
                                color: ['#2a7904', 'rgba(112,53,23,0.84)']
                            }
                        ]
                    };

                    myChart.setOption(option);


                    window.addEventListener('resize', function() {
                        myChart.resize();
                    });
                });
            },
            closeReserveDetail() {
                this.showReserveDetailPop = false;
            },
            goToReserve(reserveId) {
                if (!this.userInf || !this.userInf.id) {
                    alert('è¯·å…ˆç™»å½•');
                    window.location.href = 'login.html';
                    return;
                }

                // Show loading state
                const button = event.target;
                const originalText = button.innerText;
                button.disabled = true;
                button.innerText = 'é¢„çº¦ä¸­...';

                // Call the API to create reservation directly
                post(`/reserveDetail/addDetailQuick/${reserveId}`)
                    .then(response => {
                        if (response.code === 200) {
                            alert('é¢„çº¦æˆåŠŸï¼');
                            // Close the popup
                            this.showReserveDetailPop = false;
                            // Refresh the reserve data to update counts
                            this.getReserveData();

                        } else {
                            // Show error message
                            alert('é¢„çº¦å¤±è´¥: ' + (response.msg || 'æœªçŸ¥é”™è¯¯'));
                            // Reset button
                            button.disabled = false;
                            button.innerText = originalText;
                        }
                    })
                    .catch(err => {
                        console.error('é¢„çº¦è¯·æ±‚å‡ºé”™:', err);
                        alert('é¢„çº¦å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
                        // Reset button
                        button.disabled = false;
                        button.innerText = originalText;
                    });
             },
             // è·å–å†å²äººæ–‡æ–°é—»æ•°æ®
             getNewsData() {
                 this.newsLoading = true;
                 get('/news/list').then(response => {
                     if (response.code === 200) {
                         this.newsData = response.data || [];
                         console.log('è·å–æ–°é—»æ•°æ®æˆåŠŸ:', this.newsData);
                     } else {
                         console.error('è·å–æ–°é—»æ•°æ®å¤±è´¥:', response.msg);
                         this.newsData = [];
                     }
                 }).catch(error => {
                     console.error('è·å–æ–°é—»æ•°æ®å¼‚å¸¸:', error);
                     this.newsData = [];
                 }).finally(() => {
                     this.newsLoading = false;
                 });
             },
             // æ ¼å¼åŒ–æ–°é—»æ—¶é—´
             formatNewsDate(dateStr) {
                 if (!dateStr) return '';
                 try {
                     const date = new Date(dateStr);
                     return date.toLocaleDateString('zh-CN', {
                         year: 'numeric',
                         month: '2-digit',
                         day: '2-digit',
                         hour: '2-digit',
                         minute: '2-digit'
                     });
                 } catch (error) {
                     return dateStr;
                 }
             },
             // æ ¼å¼åŒ–æ‰¹æ¬¡æ—¶é—´
             formatBatchTime(batchTime) {
                 if (!batchTime) return '';
                 try {
                     const date = new Date(batchTime);
                     return date.toLocaleDateString('zh-CN', {
                         year: 'numeric',
                         month: '2-digit',
                         day: '2-digit'
                     });
                 } catch (error) {
                     return batchTime;
                 }
             }
         }
     })

     const vm2 = new Vue({
        el: '#loginVue',
        data: {
            userInf: {} // ç”¨æˆ·ä¿¡æ¯ä»æ¥å£è·å–
        },
        mounted() {
            // æ·»åŠ mountedé’©å­ï¼Œè·å–ç”¨æˆ·ä¿¡æ¯
            this.fetchUserInfo();
        },
        methods: {
            // è·å–ç”¨æˆ·ä¿¡æ¯
            fetchUserInfo() {
                const token = sessionStorage.getItem('token');
                if (!token) {
                    this.userInf = {};
                    return;
                }

                get('/user/me').then(response => {
                    if (response.code === 200 && response.data) {
                        this.userInf = response.data;
                    } else {
                        this.userInf = {};
                    }
                }).catch(error => {
                    console.error('è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error);
                    this.userInf = {};
                });
            },
            // ä¿®æ”¹é€€å‡ºç™»å½•æ–¹æ³•
            async loginOut() {
                try {
                    // è°ƒç”¨åç«¯æ¥å£ä½¿ token å¤±æ•ˆ
                    await post('/user/logout');
                } catch (error) {
                    console.error('é€€å‡ºå¤±è´¥:', error);
                } finally {
                    // æ¸…é™¤æœ¬åœ° token
                    sessionStorage.removeItem('token');
                    // è·³è½¬åˆ°ç™»å½•é¡µ
                    window.location.href = 'login.html';
                }
            }
        }
    })


</script>

</body>
</html>
