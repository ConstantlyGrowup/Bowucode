<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="application/json;charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>古董展览馆导览</title>
    <link rel="stylesheet" href="css/ChatTest.css">
    <!-- 引入 marked.js -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- 引入 Vue 和 Axios -->
    <script src="./util/vue.js"></script>
    <script src="./util/axios.js"></script>
    <script src="./util/request.js"></script>
</head>
<body>
<div id="app" class="background-gradient">
    <header class="app-header">
        <h1 style="color: rgba(223,148,3,0.73)">文旅导览僧</h1>
        <div class="cloud-decoration left-cloud"></div>
        <div class="cloud-decoration right-cloud"></div>
        <div style="position: absolute; top: 10px; right: 10px;">
            <a href="index.html" class="return-button" style="display: inline-block; padding: 5px 10px; background-color: rgba(223,148,3,0.73); color: white; border-radius: 5px; text-decoration: none; font-size: 14px;">返回首页</a>
        </div>
    </header>

    <main class="app-main">
        <div class="chat-container">
            <div id="chat-messages"></div>
            <form id="chat-form">
                <input type="text" id="user-input" placeholder="请输入您的问题..." required>
                <button type="submit">发送</button>
            </form>
        </div>
    </main>

    <footer class="app-footer">
        <p style="font-size: larger">开放时间：工作日上午 9:00 - 下午 5:00</p>
        <p>地址：桐梓坡路 | 电话：(010) 1145-1478</p>
    </footer>
</div>

<script type="module" src="js/ChatTest.js"></script>
<script>
    // 添加鉴权检查
    new Vue({
        el: '#app',
        mounted() {
            // 检查用户是否登录
            const token = sessionStorage.getItem('token');
            if (!token) {
                alert('请先登录！');
                window.location.href = 'login.html';
                return;
            }
            
            // 验证用户登录状态
            this.checkLoginStatus();
        },
        methods: {
            // 验证用户登录状态
            checkLoginStatus() {
                get('/user/me')
                    .then(response => {
                        if (response.code === 200 && response.data && response.data.id) {
                            // 用户已登录，可以继续使用聊天功能
                            console.log('用户已登录:', response.data);
                        } else {
                            // 用户未登录或登录状态无效
                            alert('请先登录！');
                            window.location.href = 'login.html';
                        }
                    })
                    .catch(err => {
                        console.error('获取用户信息失败:', err);
                        alert('请先登录！');
                        window.location.href = 'login.html';
                    });
            }
        }
    });
</script>
</body>
</html>

